<!DOCTYPE html>
<html lang="jp">
  <head>
    <meta charset="utf-8">
    <title>Linuxのインストール（Raspberry Pi）</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
  <div class="main">
    <h1>Linuxのインストール（Raspberry Pi）</h1>

    <p>
      Linuxはオープンソースのオペレーティングシステム（OS）です。<br>
      Raspberry PiではUbuntu Server 20.04 LTSを使います。
    </p>
    <br>

    <ul>
      <li><a href="#Raspberry Pi Imagerのインストール">Raspberry Pi Imagerのインストール</a></li>
      <li><a href="#ディスクイメージの書き込み">ディスクイメージの書き込み</a></li>
      <li><a href="#Raspberry Piの設定">Raspberry Piの設定</a></li>
      <li><a href="#ホスト名の変更">ホスト名の変更</a></li>
      <li><a href="#ユーザーの追加">ユーザーの追加</a></li>
      <li><a href="#有線LANの設定">有線LANの設定</a></li>
      <li><a href="#ssh接続">ssh接続</a></li>
      <li><a href="#無線LANの設定">無線LANの設定</a></li>
      <li><a href="#GUIが起動する場合">GUIが起動する場合</a></li>
    </ul>

    <section>

    <h3 id="Raspberry Pi Imagerのインストール">Raspberry Pi Imagerのインストール</h3>
    <p>
      公式のディスクイメージ書き込みツールRaspberry Pi Imager
      を使ってSDカードにディスクイメージを書き込みます。
    </p>
    <p>
      詳しくは
      <a href=https://www.raspberrypi.org/software/>公式HP</a>
      を参照してください。
    </p>

    <p>
      以下のコマンドを実行してRaspberry Pi Imagerを
      インストールする。
    </p>

    <ul>
      <pre>$ snap install rpi-imager</pre>
    </ul>
    
    <br>
    <h3 id="ディスクイメージの書き込み">ディスクイメージの書き込み</h3>
    
    <p>
      Raspberry Pi Imagerを起動します。<br>
     [OSを選ぶ]ボタンをクリックします。
    </p>

    <div style="text-align:center">
      <img src="images/rpi_imager_img_01.png"
           alt="Raspberry Pi Imager 1">
    </div>

    <p>
      [Other general purpose OS]を選択します。
    </p>

    <div style="text-align:center">
      <img src="images/rpi_imager_img_02.png"
           alt="Raspberry Pi Imager 2">
    </div>

    <p>
      [Ubuntu]を選択します。
    </p>

    <div style="text-align:center">
      <img src="images/rpi_imager_img_03.png"
           alt="Raspberry Pi Imager 3">
    </div>

    <p>
      [Ubuntu Server 20.04.4 LTS 64bit]を選択します。
    </p>

    <div style="text-align:center">
      <img src="images/rpi_imager_img_04.png"
           alt="Raspberry Pi Imager 4">
    </div>

    <p>
      SDカードを挿入して、
      [ストレージを選ぶ]ボタンをクリックします。
    </p>

    <div style="text-align:center">
      <img src="images/rpi_imager_img_05.png"
           alt="Raspberry Pi Imager 5">
    </div>

    <p>
      挿入したSDカードを選択します。
    </p>

    <div style="text-align:center">
      <img src="images/rpi_imager_img_06.png"
           alt="Raspberry Pi Imager 6">
    </div>

    <p>
      [書き込む]ボタンをクリックします。
    </p>

    <div style="text-align:center">
      <img src="images/rpi_imager_img_07.png"
           alt="Raspberry Pi Imager 7">
    </div>

    <p>
      [はい]ボタンをクリックします。
    </p>

    <div style="text-align:center">
      <img src="images/rpi_imager_img_08.png"
           alt="Raspberry Pi Imager 8">
    </div>

    <p>
      書き込み中。
    </p>

    <div style="text-align:center">
      <img src="images/rpi_imager_img_09.png"
           alt="Raspberry Pi Imager 9">
    </div>

    <p>
      [続ける]ボタンをクリックします。
    </p>

    <div style="text-align:center">
      <img src="images/rpi_imager_img_10.png"
           alt="Raspberry Pi Imager 10">
    </div>

    <p>
      Raspberry Pi Imagerを閉じる。<br>
      SDカードをUnmountして取り出す。
    </p>

    <br>
    <h3 id="Raspberry Piの設定">Raspberry Piの設定</h3>

    <p>
      Raspberry Piにモニター、キーボード、LANケーブルを
      接続してください。<br>
      SDカードを挿入して電源を入れます。
    </p>

    <p>
      しばらくすると次のような場面が表示されます。<br>
      ユーザー名はubuntu、パスワードはubuntuです。<br>
      パスワードを変更するよう要求されるので、
      hirate2020と設定してください。<br>
      ※パスワードは表示されません
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">Ubuntu 20.04.2 LTS ubuntu tty1

ubuntu login: <font color="#ff0000">ubuntu</font>
Password: <font color="#ff0000">ubuntu</font>
You are required to change your password immediately (administrator enforced)
Changing password for ubuntu.
Current password: <font color="#ff0000">ubuntu</font>
New password: <font color="#ff0000">hirate2020</font>
Retype new password: <font color="#ff0000">hirate2020</font>
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-1028-raspi aarch64)
・・・
ubuntu@ubuntu:~$</pre>
    </ul>

    <br>
    <h3 id="ホスト名の変更">ホスト名の変更</h3>

    <p>
      現在の設定値を確認します。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">ubuntu@ubuntu:~$ hostnamectl
   Static hostname: ubuntu
         Icon name: computer
        Machine ID: 43a374fd544d486c85b565c2a9c5a133
           Boot ID: 1fe93654c2384ec68e119ba1808d1216
  Operating System: Ubuntu 20.04.4 LTS
            Kernel: Linux 5.4.0-1052-raspi
      Architecture: arm64</pre>
    </ul>

    <p>
      ホスト名をubuntuからzumo00に変更します。
      番号は、各自が使っているZumoの番号です。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">ubuntu@ubuntu:~$ hostnamectl set-hostname zumo00
==== AUTHENTICATING FOR org.freedesktop.hostname1.set-static-hostname ===
Authentication is required to set the statically configured local host name, as well as the pretty host name.
Authenticating as: Ubuntu (ubuntu)
Password: 
==== AUTHENTICATION COMPLETE ===</pre>
    </ul>

    <p>
      ホスト名が変更できているか確認します。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">ubuntu@ubuntu:~$ hostnamectl
   Static hostname: zumo00
         Icon name: computer
        Machine ID: 43a374fd544d486c85b565c2a9c5a133
           Boot ID: 1fe93654c2384ec68e119ba1808d1216
  Operating System: Ubuntu 20.04.4 LTS
            Kernel: Linux 5.4.0-1052-raspi
      Architecture: arm64</pre>
    </ul>

    <p>
      再起動します。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">ubuntu@ubuntu:~$ sudo shutdown -r now</pre>
    </ul>

    <p>
      ホスト名が変更されていることを確認してください。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">ubuntu@<font color="#ff0000">zumo00</font>:~$</pre>
    </ul>

    <br>
    <h3 id="ユーザーの追加">ユーザーの追加</h3>

    <p>
      piというユーザーを追加します。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">ubuntu@zumo00:~$ sudo adduser pi
Adding user `pi' ...
Adding new group `pi' (1001) ...
Adding new user `pi' (1001) with group `pi' ...
Creating home directory `/home/pi' ...
Copying files from `/etc/skel' ...
New password: <font color="#ff0000">hirate2020</font>
Retype new password: <font color="#ff0000">hirate2020</font>
passwd: password updated successfully
Changing the user information for pi
Enter the new value, or press ENTER for the default
	Full Name []: <font color="#ff0000">press [Enter]key</font>
	Room Number []: <font color="#ff0000">press [Enter]key</font>
	Work Phone []: <font color="#ff0000">press [Enter]key</font>
	Home Phone []: <font color="#ff0000">press [Enter]key</font>
	Other []: <font color="#ff0000">press [Enter]key</font>
Is the information correct? [Y/n] y</pre>
    </ul>

    <p>
      piをsudoグループに追加します。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">ubuntu@zumo00:~$ sudo adduser pi sudo
Adding user `pi' to group `sudo' ...
Adding user pi to group sudo
Done.</pre>
    </ul>

    <p>
      ubuntuとrootをロックします。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">ubuntu@zumo00:~$ sudo passwd -d ubuntu
passwd: password expiry information changed.
ubuntu@zumo00:~$ sudo passwd -l ubuntu
passwd: password expiry information changed.
ubuntu@zumo00:~$ sudo passwd -l root
passwd: password expiry information changed.</pre>
    </ul>

    <p>
      この段階で、ログインできるユーザーはpiのみとなります。<br>
      一度ログアウトします。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">ubuntu@zumo00:~$ exit</pre>
    </ul>

    <p>
      piでログインしてください。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;"><font color="#ff0000">pi</font>@zumo00:~$</pre>
    </ul>

    <br>
    <h3 id="ssh接続">ssh接続</h3>

    <p>
      PCからRaspberry Piを遠隔操作するために
      ssh接続をします。<br>
      今回は、Ubuntuに標準でインストールされている
      Remminaを使います。
    </p>

    <p>
      はじめに、Raspberry PiのIPアドレスを調べます。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">pi@zumo00:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether b8:27:eb:71:91:bf brd ff:ff:ff:ff:ff:ff
    inet <font color="#ff0000">192.168.1.51</font>/24 brd 192.168.1.255 scope global dynamic eth0
       valid_lft 258007sec preferred_lft 258007sec
    inet6 fe80::ba27:ebff:fe71:91bf/64 scope link 
       valid_lft forever preferred_lft forever
3: wlan0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000
    link/ether b8:27:eb:24:c4:ea brd ff:ff:ff:ff:ff:ff</pre>
    </ul>

    <p>
      Remminaを起動します。<br>
      [New connection profile]ボタンをクリックします。
    </p>

    <div style="text-align:center">
      <img src="images/ssh_img_01.png"
           alt="SSH Connection 1">
    </div>

    <p>
      「リモートデスクトップの設定」ウィンドウが立ち上がります。<br>
      必要な情報を入力して、[保存]ボタンをクリックする。
    </p>

    <div style="text-align:center">
      <img src="images/ssh_img_02.png"
           alt="SSH Connection 2">
    </div>

    <p>
      zumo00という名前の接続が追加されました。<br>
      zumo00をダブルクリックするとラズベリーパイと接続されます。
    </p>

    <div style="text-align:center">
      <img src="images/ssh_img_03.png"
           alt="SSH Connection 3">
    </div>

    <p>
      zumo08と接続されました。<br>
      以降、Raspberry Piの操作はこの画面から行います。
    </p>

    <div style="text-align:center">
      <img src="images/ssh_img_04.png"
           alt="SSH Connection 4">
    </div>

    <br>
    <h3 id="無線LANの設定">無線LANの設定</h3>

    <p>
      現在のネットワークの設定を確認します。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">pi@zumo00:~$ cat /etc/netplan/50-cloud-init.yaml 
# This file is generated from information provided by the datasource.  Changes
# to it will not persist across an instance reboot.  To disable cloud-init's
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        eth0:
            dhcp4: true
            optional: true
    version: 2</pre>
    </ul>

    <p>
      現在の設定ファイルをコピーして、新しい設定ファイルを作ります。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">pi@zumo00:~$ sudo cp /etc/netplan/50-cloud-init.yaml /etc/netplan/99_config.yaml
[sudo] password for pi:</pre>
    </ul>

    <p>
      新しい設定ファイルを編集します。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">$ sudo nano /etc/netplan/99_config.yaml</pre>
    </ul>

    <p>
      IPアドレスには、自分が使っているZumoに割り振られたIPアドレスを入力してください。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;"># This file is generated from information provided by the datas>
# to it will not persist across an instance reboot.  To disable>
# network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the>
# network: {config: disabled}
network:
    ethernets:
        eth0:
            dhcp4: true
            optional: true
    <font color="#ff0000">wifis:</font>
        <font color="#ff0000">wlan0:</font>
            <font color="#ff0000">dhcp4: false</font>
            <font color="#ff0000">optional: true</font>
            <font color="#ff0000">addresses: [192.168.1.250/24]</font>
            <font color="#ff0000">gateway4: 192.168.1.1</font>
            <font color="#ff0000">nameservers:</font>
                <font color="#ff0000">addresses: [192.168.1.1]</font>
                <font color="#ff0000">search: []</font>
            <font color="#ff0000">access-points:</font>
                <font color="#ff0000">htc-s-ap:</font>
                    <font color="#ff0000">password: "uEv3hTwpS7"</font>
    version: 2</pre>
    </ul>

    <p>
      設定を反映させます。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">$ sudo netplan apply</pre>
    </ul>

    <p>
      Raspberry Piを終了します。（Remminaのssh接続は切断されます）
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">$ sudo shutdown -h now</pre>
    </ul>

    <p>
      wifiでネットワークに接続されているか確認します。<br>
      LANケーブルを抜いてからRaspberry Piを起動してください。
    </p>

    <p>
      IPアドレスを確認します。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">pi@zumo00:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc fq_codel state DOWN group default qlen 1000
    link/ether b8:27:eb:71:91:bf brd ff:ff:ff:ff:ff:ff
3: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether b8:27:eb:24:c4:ea brd ff:ff:ff:ff:ff:ff
    inet <font color="#ff0000">192.168.1.250</font>/24 brd 192.168.1.255 scope global wlan0
       valid_lft forever preferred_lft forever
    inet6 fe80::ba27:ebff:fe24:c4ea/64 scope link 
       valid_lft forever preferred_lft forever</pre>
    </ul>
    
    <p>
      次のコマンドを実行して、インターネットとつながっているか確認してください。
    </p>

    <ul>
      <pre style="background-color: #FFFACD;">$ ping youtube.com
PING youtube.com (172.217.27.78) 56(84) bytes of data.
64 bytes from nrt12s15-in-f14.1e100.net (172.217.27.78): icmp_seq=1 ttl=113 time=61.6 ms
64 bytes from nrt12s15-in-f14.1e100.net (172.217.27.78): icmp_seq=2 ttl=113 time=20.7 ms
64 bytes from nrt12s15-in-f14.1e100.net (172.217.27.78): icmp_seq=3 ttl=113 time=19.2 ms
・・・</pre>
    </ul>

    <p>
      Remminaでwifi用の接続も作成しておきましょう。<br>
      名前はzumo00-wifiとします。
    </p>

  </div>
  </body>
</html>
